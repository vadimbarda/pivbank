/*
Copyright(c) 2013
*/
jQuery.cookie=function(d,e,b){if(arguments.length>1&&String(e)!=="[object Object]"){b=jQuery.extend({},b);if(e===null||e===undefined){b.expires=-1}if(typeof b.expires==="number"){var g=b.expires,c=b.expires=new Date();c.setDate(c.getDate()+g)}e=String(e);return(document.cookie=[encodeURIComponent(d),"=",b.raw?e:encodeURIComponent(e),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join(""))}b=e||{};var a,f=b.raw?function(h){return h}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(d)+"=([^;]*)").exec(document.cookie))?f(a[1]):null};var Base=function(){};Base.extend=function(b,e){var f=Base.prototype.extend;Base._prototyping=true;var d=new this;f.call(d,b);d.base=function(){};delete Base._prototyping;var c=d.constructor;var a=d.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==a){this._constructing=true;c.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||f).call(arguments[0],d)}}}};a.ancestor=this;a.extend=this.extend;a.forEach=this.forEach;a.implement=this.implement;a.prototype=d;a.toString=this.toString;a.valueOf=function(g){return(g=="object")?a:c.valueOf()};f.call(a,e);if(typeof a.init=="function"){a.init()}return a};Base.prototype={extend:function(b,h){if(arguments.length>1){var e=this[b];if(e&&(typeof h=="function")&&(!e.valueOf||e.valueOf()!=h.valueOf())&&/\bbase\b/.test(h)){var a=h.valueOf();h=function(){var k=this.base||Base.prototype.base;this.base=e;var i=a.apply(this,arguments);this.base=k;return i};h.valueOf=function(i){return(i=="object")?h:a};h.toString=Base.toString}this[b]=h}else{if(b){var g=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){g=this.extend||g}var d={toSource:null};var f=["constructor","toString","valueOf"];var c=Base._prototyping?0:1;while(j=f[c++]){if(b[j]!=d[j]){g.call(this,j,b[j])}}for(var j in b){if(!d[j]){g.call(this,j,b[j])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,d,c){for(var b in a){if(this.prototype[b]===undefined){d.call(c,a[b],b,a)}}},implement:function(){for(var a=0;a<arguments.length;a++){if(typeof arguments[a]=="function"){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return String(this.valueOf())}});var JSON=JSON||{};(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());pb={settingsUrl:"data/settings.xml",settings:null,initializeTransitions:function(b){$("#"+b).addClass("active");var a=$("body");a.css("display","none");a.fadeIn(500,function(){a.css("display","block")});$("a.transition").click($.proxy(this.onLinkClick,this))},redirectPage:function(){window.location=this.linkLocation},onLinkClick:function(b,a){b.preventDefault();if(!$(b.target).hasClass("active")){this.linkLocation=b.target.href;$("body").fadeOut(500,$.proxy(this.redirectPage,this))}},applyTemplate:function(f,h){var d=f;var e=/\{\w*\}/g;var b=d.match(e);if(b){for(var c=0;c<b.length;c++){var a=b[c];var g=a.substr(1,a.length-2);d=d.replace(a,h[g]||"")}}return d},format:function(d){var c=d;for(var a=1;a<arguments.length;a++){var b=new RegExp("\\{"+(a-1)+"\\}","gi");c=c.replace(b,arguments[a])}return c},getFloat:function(a){if(!a){return null}return parseFloat(a.replace(",","."))},toStr:function(a){return a.toString().replace(".",",")},concatStrings:function(){var a=Array.prototype.slice.call(arguments);return a.join("")},initializeOrderController:function(a){this.orderController=new pb.OrderController(a)},updateWorkTime:function(a){this.workTimeController=new pb.WorkTimeController(a)},getDateByTime:function(b){b=b.split(":");var a=new Date();a.setHours(b[0]);a.setMinutes(b[1]);return a},getWorkStartDate:function(){return this.getDateByTime(this.settings.WorkStartTime)},getWorkEndDate:function(){return this.getDateByTime(this.settings.WorkEndTime)},getOrderStartDate:function(){return this.getWorkStartDate()},getOrderEndDate:function(){var a=this.getWorkEndDate();a.setMinutes(a.getMinutes()-15);return a}};pb.OrderController=Base.extend({defaults:{productsUrl:"data/products.xml",getDataUrl:"http://91.200.201.188:81/data/products.xml",postDataUrl:"http://91.200.201.188:81/BeerShopService.asmx/AddOrder"},postSuccessMessage:"Ваш заказ зарегистрирован и будет доставлен в ближайшие 30 минут",errorBeerQuantityMessage:"Заказ должен содержать не мение {0} л. пива, а в Вашем заказе {1} л.",isNotWorkTimeMessage:"Прием заказов осуществляется с {0} до {1}. Сейчас заказы не принимаются",settingsErrorMessage:"Ошибка получения файла с настройками. Повторите попытку позже",productsErrorMessage:"Ошибка соединения с магазином. Повторите попытку позже",products:null,beerTable:null,snacksTable:null,addressInput:null,addressError:null,phoneError:null,phoneInput:null,acceptDelivery:null,acceptDeliveryError:null,descriptionInput:null,message:null,productPicture:null,order:null,constructor:function(a){this.config=$.extend({},this.defaults,a);this.initializeTabs();this.getSettings();this.defineProperties();this.initializeEvents();this.initializeMessagePanel();this.initializeLoader();this.order=new pb.Order()},initializeTabs:function(){$("ul.product-tabs-header").tabs("div.product-tabs-content > div",{effect:"fade"});var a=$("ul.product-tabs-header").data("tabs");a.onClick($.proxy(this.onTabsChange,this))},initializeEvents:function(){$(".order-beer-bottles").live("click",$.proxy(this.onAddButtonClick,this));$(".order-beer-information").live("click",$.proxy(this.onDescriptionIconClick,this));$("#sendButton").click($.proxy(this.onSendButtonClick,this));this.addressInput.focusin($.proxy(this.hideAllErrorMessage,this));this.phoneInput.focusin($.proxy(this.hideAllErrorMessage,this));this.acceptDelivery.click($.proxy(this.hideAllErrorMessage,this));this.descriptionInput.focusin($.proxy(this.hideAllErrorMessage,this))},defineProperties:function(){this.beersTable=$("#beersTable");this.snacksTable=$("#snacksTable");this.addressInput=$("#edtAddress");this.addressError=$(".form-error.address");this.phoneInput=$("#edtPhone");this.phoneError=$(".form-error.phone");this.acceptDelivery=$("#acceptDeliveryCondition");this.acceptDeliveryError=$(".form-error.rules");this.descriptionInput=$("#edtDescription");this.productPicture=$(".product-picture")},initializeMessagePanel:function(){var b=$("#overlayTarget");var a={color:"#4a4a45",loadSpeed:200,opacity:0.9};b.overlay({mask:a,top:"center",closeOnClick:false,onLoad:function(){var c=this.getOverlay();var e=($(window).width()-c.width())/2;var d=($(window).height()-c.height())/2;c.css({left:e+"px",top:d+"px"})}});this.messagePanel=b.data("overlay")},initializeLoader:function(){var b=$("#loaderTarget");var a={color:"#4a4a45",loadSpeed:200,opacity:0.9};b.overlay({mask:a,top:"center",closeOnClick:false,closeOnEsc:false,onLoad:function(){var c=this.getOverlay();var e=($(window).width()-c.width())/2;var d=($(window).height()-c.height())/2;c.css({left:e+"px",top:d+"px"})}});this.loader=b.data("overlay")},getSettings:function(){$.ajax({url:pb.settingsUrl,cache:false,success:$.proxy(this.onGetSettings,this),error:$.proxy(this.onGetSettingsError,this)})},onGetSettings:function(d,c,h){pb.settings={};var f=$(d).find("item");for(var e=0;e<f.length;e++){var j=f[e];var b=j.getAttribute("Code");var g=j.getAttribute("Value");pb.settings[b]=g}var a=this.config.getDataUrl;if(!this.isWorkTime()){a=this.config.productsUrl}this.showLoader("Соеднинение с магазином ...");$.support.cors=true;$.ajax({url:a,crossDomain:true,cache:false,success:$.proxy(this.onGetProductsXml,this),error:$.proxy(this.onGetProductsError,this)})},isWorkTime:function(){var c=pb.getWorkStartDate();var a=pb.getOrderEndDate();var b=new Date();return(b>=c)&&(b<a)},showNotWorkTimeMessage:function(){var d=pb.getOrderStartDate();var b=d.getMinutes();if(b<10){b="0"+b}var d=d.getHours()+":"+b;var a=pb.getOrderEndDate();var b=a.getMinutes();if(b<10){b="0"+b}var a=a.getHours()+":"+b;var c=pb.format(this.isNotWorkTimeMessage,d,a);this.showInformationMessage(c)},onGetSettingsError:function(a,c,b){this.showWarningMessage(this.settingsErrorMessage)},onGetProductsXml:function(c,a,h){this.hideLoader();this.products=[];var e=c;if($.browser.msie&&parseFloat($.browser.version)<=9){e=$.parseXML(c)}var g=$(e).find("item");for(var d=0;d<g.length;d++){var f=g[d].attributes;var l={};for(var b=0;b<f.length;b++){var k=f[b];l[k.name]=k.value}this.products.push(l)}this.products.sort(this.sortProductsByName);this.showProducts();if(this.isWorkTime()){if(pb.settings.SiteBroadcastMessage){setTimeout($.proxy(this.showInformationMessage,this,pb.settings.SiteBroadcastMessage),500)}}else{setTimeout($.proxy(this.showNotWorkTimeMessage,this),500)}},onGetProductsError:function(a,c,b){this.hideLoader();setTimeout($.proxy(this.showWarningMessage,this,this.productsErrorMessage),500)},sortProductsByName:function(d,c){return(d.Name>c.Name)?1:-1},showProducts:function(){for(var a=0;a<this.products.length;a++){var b=this.products[a];if(b.TypeName==pb.settings.BeerTypeProduct){this.showBeer(b)}else{this.showSnack(b)}}},showBeer:function(c){var b=pb.concatStrings("<tr>",'<td class="order-product-logo line" rowspan="2"><img src="{LogoFileName}" alt="[логотип]" /></td>','<td class="order-beer-text">','<div class="order-beer-info-item order-beer-name">{Name} {BeerType}</div>','<div class="order-beer-price">Цена: <span class = "{priceCls}" title="{hotPriceTitle}">{Price} грн./{UnitName}</span></div>','<div class="order-beer-info-item">Производитель: {AccountCityName}</div>','<div class="order-beer-info-item">Алкоголь: {Alcohol}%</div>','<div class="order-beer-info-item">Плотность: {Density}%</div>',"</td>",'<td class="order-beer-bottles">{buttons}</td>',"</tr>","<tr>",'<td class="line" colspan="2">','<div class="order-beer-information">Описание</div>','<div class="order-beer-description">{Information}</div>',"</td>","</tr>");c.Information=c.Information||"Описание отсутствует";if(c.BeerType){c.BeerType="("+c.BeerType+")"}if(c.IsStockPrice=="1"){c.priceCls="hot-price";c.hotPriceTitle="Акционная цена"}c.Alcohol=c.Alcohol||"0";c.Density=c.Density||"0";c.Price=pb.toStr(pb.getFloat(c.Price).toFixed(2));c.buttons=this.getAddButtons(c.ID);var a=pb.applyTemplate(b,c);this.beersTable.append(a)},getAddButtons:function(b){var c='<input type="button" value="Добавить {0}л." class="button" productId={1} quantity="{2}" />';var f=pb.settings.bottles;var f=f.split(";");var e="";for(var a=0;a<f.length;a++){var d=f[a];e+=pb.format(c,d,b,pb.getFloat(d))}return e},showSnack:function(c){var b=pb.concatStrings('<tr class="line">','<td class="order-beer-text line"><div class="order-beer-name">{Name}</div></td>','<td class="order-beer-price line">{Price} грн./{UnitName}</td>','<td class="order-beer-bottles line">','<input type="button" value="Добавить" class="button" productId={ID} quantity="1"/>',"</td>","</tr>");c.Price=pb.toStr(pb.getFloat(c.Price).toFixed(2));var a=pb.applyTemplate(b,c);this.snacksTable.append(a)},getProductById:function(c){var b=null;for(var a=0;a<this.products.length;a++){if(this.products[a].ID==c){var b=this.products[a];break}}return b},onAddButtonClick:function(f){var a=f.target;var b=a.getAttribute("productId");var c=this.getProductById(b);var d=parseFloat(a.getAttribute("quantity"));this.order.addProduct(c,d)},onSendButtonClick:function(){if(this.isWorkTime()){if(this.checkInputsValidity()){var b=this.order.getOrderBeerQuantity();var d=pb.getFloat(pb.settings.MinOrderBeerQuantity);if(b<d){var c=pb.format(this.errorBeerQuantityMessage,pb.toStr(d),pb.toStr(b));this.showWarningMessage(c)}else{this.showLoader("Регистрация заказа ...");var a=this.order.getJSON();$.ajax({url:this.config.postDataUrl,data:{order:JSON.stringify(a)},dataType:"jsonp",success:$.proxy(this.onPostData,this),error:$.proxy(this.onPostDataError,this)});this.timer=setTimeout($.proxy(this.onPostDataError,this),30000)}}}else{this.showNotWorkTimeMessage()}},onPostData:function(d,e,c){clearTimeout(this.timer);this.hideLoader();var b=$.parseJSON(d.d);var a=b.status;if(a=="OK"){this.animatePoliceCar()}else{setTimeout($.proxy(this.showWarningMessage,this,a),500)}},onPostDataError:function(a,c,b){this.hideLoader();setTimeout($.proxy(this.showWarningMessage,this,this.productsErrorMessage))},checkInputsValidity:function(){var d=true;var c=this.addressInput.attr("value");if(!c){d=false;this.addressError.show()}var b=this.phoneInput.attr("value");if(!b){d=false;this.phoneError.show()}var a=this.acceptDelivery.attr("checked");if(!a){d=false;this.acceptDeliveryError.show()}return d},hideAllErrorMessage:function(){this.addressError.hide();this.phoneError.hide();this.acceptDeliveryError.hide()},onDescriptionIconClick:function(c){var a=c.target;var b=a.nextSibling;$(a).toggleClass("expanded");$(b).slideToggle()},showMessage:function(e,c,a){var b=this.messagePanel.getOverlay();var d=b.find(".message-title");d.removeClass();d.addClass("message-title");d.addClass(a);d.html(e);b.find(".message").html(c);this.messagePanel.load()},showLoader:function(c){var a=this.loader.getOverlay();var b=a.find(".loader-message");b.html(c);this.loader.load()},hideLoader:function(){this.loader.close()},showWarningMessage:function(a){this.showMessage("Внимание",a,"warning")},showInformationMessage:function(a){this.showMessage("Сообщение",a,"information")},onTabsChange:function(b,a){if(a==0){this.productPicture.removeClass("fish");this.productPicture.addClass("beer")}else{this.productPicture.removeClass("beer");this.productPicture.addClass("fish")}},animatePoliceCar:function(){var a=$(".police-car");a.animate({right:"-=50"},200);a.animate({right:"+=200"},200);a.animate({right:"+=400",top:"-=200"},1000);a.animate({right:"+=20"},2000);a.animate({right:"-=50"},200);a.animate({right:"+=1000",opacity:0},1000,$.proxy(this.onCarAnimationComplete,this))},onCarAnimationComplete:function(){$(".police-car").css({right:60,top:550,opacity:1,display:"none"});this.order.clear();this.showInformationMessage(this.postSuccessMessage)}});pb.Order=Base.extend({orderTable:null,orderAmount:null,discount:0,constructor:function(){this.orderTable=$("#orderTable");this.orderAmount=$("#orderAmount");this.initializeEvents();this.readCoockie()},readCoockie:function(){var a=$.cookie("pivbankOrder");if(a){this.orderTable.html(a)}var c=$.cookie("pivbankOrderDetails");if(c){var b=c.split(";");if(this.discount==10){$("#rbTenPercentDiscount").attr("checked",true)}else{if(this.discount==5){$("#rbFivePercentDiscount").attr("checked",true)}else{$("#rbNoDiscount").attr("checked",true)}}$("#edtAddress").val(b[1]);$("#edtPhone").val(b[2]);$("#edtDescription").val(b[3])}this.calcOrderAmount();this.showOrderDetails(this.orderTable.find("tr").length>0)},initializeEvents:function(a){$(".remove-button").live("click",$.proxy(this.onRemoveButtonClick,this));$(".discount-percent-radiobutton input").click($.proxy(this.onDiscountRadiobuttonClick,this));$(window).unload($.proxy(this.saveOrderToCookie,this))},addProduct:function(c,d){var b;if(c.TypeName!=pb.settings.BeerTypeProduct){var a=pb.applyTemplate('tr[productId="{productId}"]',{productId:c.ID});b=this.orderTable.find(a)}if(b&&(b.length>0)){this.addProductQuantity(b,1)}else{this.addProductHTML(c,d)}this.onProductListChanged()},getCurrentQuantity:function(c){var a=c.find(".quantity");var b=a.html().split(" ");return newQuantity=pb.getFloat(b[0])},addProductQuantity:function(j,c){var b=j.find(".cost");var d=pb.getFloat(b.html());var h=j.find(".quantity");var e=h.html().split(" ");var g=pb.getFloat(e[0]);var f=d/g;var a=g+c;var i=f*a;h.html(pb.toStr(a)+" "+e[1]);b.html(pb.toStr(i.toFixed(2)))},addProductHTML:function(f,g,e){var b=pb.concatStrings('<tr productid={productId} issnack="{isSnack}" alcohol="{alcohol}">','<td class="remove-button-column"><input type="image" class="remove-button" src="img/s.png" title="Удалить из заказа"/></td>','<td class="name">{name}</span></td>','<td class="quantity">{quantity} {unit}</td>','<td class="cost">{cost}</td>',"</tr>");var d=pb.getFloat(f.Price);var c={productId:f.ID,isSnack:(f.TypeName!=pb.settings.BeerTypeProduct)||"false",alcohol:pb.getFloat(f.Alcohol)||"0",name:f.Name,quantity:pb.toStr(g),unit:f.UnitName,cost:pb.toStr((g*d).toFixed(2))};var a=pb.applyTemplate(b,c);if(e){e.before(a)}else{this.orderTable.append(a)}},onRemoveButtonClick:function(c){var f=$(c.target.parentNode.parentNode);var d=(f.attr("issnack")=="true");var b=this.getCurrentQuantity(f);if(!d||(b==1)){var a=this;f.fadeOut(function(){f.remove();a.onProductListChanged()})}else{this.addProductQuantity(f,-1);this.onProductListChanged()}},onDiscountRadiobuttonClick:function(b){var a=b.target;this.discount=parseInt(a.value);this.calcOrderAmount()},onProductListChanged:function(){this.calcOrderAmount();this.showOrderDetails(this.orderTable.find("tr").length>0)},calcOrderAmount:function(){var a=$("#orderTable .cost");var c=0;for(var b=0;b<a.length;b++){var d=pb.getFloat(a[b].innerHTML);c+=d}var c=c-(c*this.discount/100);var d="Сумма: "+pb.toStr(c.toFixed(2));this.orderAmount.fadeOut(function(){$(this).html(d).fadeIn()})},saveOrderToCookie:function(){var a=this.orderTable.html();$.cookie("pivbankOrder",a);var b=this.getOrderDetails();$.cookie("pivbankOrderDetails",b)},getOrderDetails:function(){var a=this.discount+";";a+=$("#edtAddress").val()+";";a+=$("#edtPhone").val()+";";a+=$("#edtDescription").val();return a},showOrderDetails:function(a){if(a){$(".order-cost").show();$(".order-details-panel").show();$(".police-car").show()}else{$(".order-cost").hide();$(".order-details-panel").hide();$(".police-car").hide()}},getOrderBeerQuantity:function(){var g=this.orderTable.find('tr[issnack="false"]');var a=pb.getFloat(pb.settings.BeerMinAlcoholQuantity);var d=0;for(var b=0;b<g.length;b++){var e=g[b];var c=pb.getFloat(e.getAttribute("alcohol"));if(c>=a){var f=this.getCurrentQuantity($(e));d+=f}}return d},getOrderItems:function(){var d=$("#orderTable tr");var a=[];for(var b=0;b<d.length;b++){var c={ProductId:d[b].getAttribute("productid"),Quantity:this.getCurrentQuantity($(d[b]))};a.push(c)}return a},getJSON:function(){var b=this.getOrderItems();var a={Address:$("#edtAddress").val(),Phone:$("#edtPhone").val(),Description:$("#edtDescription").val(),Discount:this.discount,Products:b};return JSON.stringify(a)},clear:function(){this.orderTable.empty();this.showOrderDetails(false)}});pb.WorkTimeController=Base.extend({constructor:function(a){this.isOrderTime=a;this.getSettings()},formatTime:function(a){var b=a.getMinutes();if(b<10){b="0"+b}var c=a.getHours()+":"+b;return c},getSettings:function(){$.ajax({url:pb.settingsUrl+"?time="+new Date().getTime(),success:$.proxy(this.onGetSettings,this),error:$.proxy(this.onGetSettingsError,this)})},onGetSettings:function(d,c,j){pb.settings={};var g=$(d).find("item");for(var e=0;e<g.length;e++){var k=g[e];var a=k.getAttribute("Code");var h=k.getAttribute("Value");pb.settings[a]=h}var b=pb.getWorkStartDate();var f=pb.getWorkEndDate();if(this.isOrderTime){f=pb.getOrderEndDate()}$("#startTime").html(this.formatTime(b));$("#endTime").html(this.formatTime(f))},onGetSettingsError:function(a,c,b){}});
